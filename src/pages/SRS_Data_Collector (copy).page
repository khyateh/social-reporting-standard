<apex:page controller="SRS_Data_Controller" docType="html-5.0" standardStylesheets="false" sidebar="false" showHeader="true">

<apex:stylesheet value="{!URLFOR($Resource.BS)}"/>
 <apex:stylesheet value="//netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css"/>
 <apex:includeScript value="//ajax.googleapis.com/ajax/libs/angularjs/1.3.0/angular.min.js"/>
 <apex:includeScript value="//ajax.googleapis.com/ajax/libs/angularjs/1.3.0/angular-sanitize.min.js"/>
 <apex:includeScript value="//ajax.googleapis.com/ajax/libs/angularjs/1.3.0/angular-route.js"/>
 <apex:includeScript value="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" />
<apex:includeScript value="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" />

 <apex:includeScript value="{!URLFOR($Resource.Rangy, "/rangy-1.2.3/rangy-core.js")}"/>
 <apex:includeScript value="{!URLFOR($Resource.Rangy, "/rangy-1.2.3/rangy-selectionsaverestore.js")}"/>
 <apex:includeScript value="//cdnjs.cloudflare.com/ajax/libs/textAngular/1.2.2/textAngular.min.js"/>
 <apex:includeScript value="//cdnjs.cloudflare.com/ajax/libs/textAngular/1.2.2/textAngular-sanitize.min.js"/>

            <style>
                .input-mysize { width: 550px }
                .search-query {
                padding-left: 469px;
                background-repeat: no-repeat;
                background-position: 562px 8px;
                }

                .ta-editor {
                min-height: 300px;
                height: auto;
                overflow: auto;
                font-family: inherit;
                font-size: 100%;
                border-size:2px;
                }

                .content{
                  background-color: light-blue;
                }
                .logoSpacer{
                  width: 100%;
                }


            </style>

          <!-- =========== Binding Controller to Body of Page ============= -->
            <div ng-app="SRSDataCollector" ng-controller="contrl" class="container app" >
              <div class="page-header">
            <br />
              <apex:image url="{!URLFOR($Resource.SRSLogo)}"/>
            </div>

  <ul class="nav nav-tabs">
    <div ng-repeat="y in items">
  <li>
    <a href="#home{{$index}}" data-toggle="tab">{{y.Content__c}}</a></li>
  </div>
</ul>
<div class="tab-content">
    <div id="home0" class="tab-pane fade in active">
      <h3>HOME</h3>
      <p>Lorem ipsum dolor sit amet, </p>
    </div>
    <div id="home1" class="tab-pane fade">
      <h3>Menu 1</h3>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
    </div>
  </div>

<div>
  <div class="col-md-8">
            <h1 class="Title" width="70%">{{pagedItems.Section__c}}</h1>
          </div>

            <div class="col-md-4" style="align: right;">Learn from <a href="www.coursera.org"><apex:image url="{!URLFOR($Resource.Coursera)}" /></a></div>
            <hr />
            <br/><br/>
            <h3>{{pagedItems.Content__c}}</h3>
          </div>

               <div ng-repeat="x in pagedItems.Page_Question__r">

            <div >{{x.Question_Text__c}}
            </div>
            <br /> <br />
            <text-angular name="textAngular-{{$index}}" ng-model="x.Answer__c" ta-disabled="disabled">

              </text-angular>
            <br /> <br />
            <!--    textarea ng-model="x.Page_Text__c" style="width: 100%"></textarea-->
          </div>

<br /><br />



                      <div class="pagination pagination-large pull-right">

                              <div >
                                <input type="button" class="btn btn-info" ng-click="prevPage()" value="Previous" />
                                &nbsp;
                                <input type="button" class="btn btn-info" ng-click="nextPage()" value="Next" />
                                &nbsp;
                                <input type="button" class="btn btn-info" ng-click="saveReport()" value="Save" />
                              </div>

                      </div>

                      <!-- Save as Template Modal -->
                      <div id="myModal" class="modal fade" role="dialog">
                        <div class="modal-dialog">

                          <!-- Modal content-->
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal">&times;</button>
                              <h4 class="modal-title">Import from an existing report </h4>
                            </div>
                            <div class="modal-body">
                              <p>Please provide a name for the template</p>
                              <input type="text" ng-model="templateName" />
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-info" ng-click="saveAsTemplate()">Save as Template</button>

                              <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
                            </div>
                          </div>

                        </div>
                      </div>

    </div>
    <hr />
    <p style="text-align:center;"><small>Created by <a href="www.khyateh.com">Khyateh</a></small></p>

    <!--- Javascript -->
    <script type="text/javascript">
    <!-- Name your application -->
        var myapp = angular.module("SRSDataCollector", ["ngRoute","textAngular", "ngSanitize"]);


    <!-- Define Controller  -->
        var contrl=myapp.controller("contrl", function ($scope,  $location, $sce, $interval) {
              $scope.currentPage = 0;
              $scope.reportName = "";
              $scope.reportDesc = "";
                $scope.reportId =  $location.absUrl().split('ReportId=')[1];
              $scope.pagedItems = "";
              $scope.templateName = "";

              <!-- Get and set the report id if it exists - OBSOLETE-->
              $scope.getReport = function(){
                  SRS_Data_Controller.getReportId(function(result, event) {
                  if(event.status)
                  {
                    $scope.reportId = result;

                  }
                  else if(event.type == "exception")
                  {
                    alert(event.message);
                  }
                });
              };



              $scope.getQuestions = function(){
                Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.SRS_Data_Controller.getAllQuestions}',
                  $scope.reportId, function(result, event) {
                  if(event.status)
                  {
                    $scope.items = result;
                    $scope.$apply();

                    if($scope.items != null)
                    {
                      $scope.pagedItems = $scope.items[$scope.currentPage];
                      $scope.$apply();
                    }
                  }
                  else if(event.type == "exception")
                  {
                    alert(event.message);
                  }
                }, {escape: false});
              };

              $scope.saveReport = function(){

                var sJson = angular.toJson($scope.items);
                SRS_Data_Controller.saveAnswers(sJson, $scope.reportName, $scope.reportId, $scope.reportDesc,
              function(result, event){
                if(event.status)
                {
                  console.log("Report saved");
                }
                else if(event.type == "exception")
                {
                  alert(event.message);
                }
              }
              )};

              $scope.range = function (start, end) {
                  var ret = [];
                  if (!end) {
                      end = start;
                      start = 0;
                  }
                  for (var i = start; i < end; i++) {
                      ret.push(i);
                  }
                  return ret;
              };

              $scope.prevPage = function () {
                  if ($scope.currentPage > 0) {
                      $scope.currentPage--;
                      $scope.pagedItems = $scope.items[$scope.currentPage];
                  }
              };

              $scope.nextPage = function () {
                  if ($scope.currentPage < $scope.items.length - 1) {
                      $scope.currentPage++;
                      $scope.pagedItems = $scope.items[$scope.currentPage];
                  }
              };
              $scope.setPage = function () {
                  $scope.currentPage = this.n;
                  $scope.pagedItems = $scope.items[$scope.currentPage];
              };
              $scope.disabled = false;

              $scope.decode = function(html) {
                var txt = document.activeElement();
                txt.innerHTML = html;
                return txt.value;
              };

            $scope.alertMe = function(){
              console.log("Here");
              alert("Save called");
            };

            $scope.saveAsTemplate = function(){
              //Save report
              console.log('From outside');
              $scope.saveReport();
              //Save report as template
              SRS_Data_Controller.saveAsTemplate($scope.reportId, $scope.templateName, function(result, event){
                if(event.status)
                {
                  alert("Template saved");
                }
                else if(event.type == "exception")
                {
                  alert(event.message);
                }

              });

            };

            $scope.getQuestions();

            var autoSave = $interval($scope.saveReport, 120000);

      });



      myapp.filter('unsafe', function($sce) {
        return function(val) {
          val = $sce.trustAsHtml(val);
          alert(val);
            return val;
        };
      });


    </script>
</apex:page>
